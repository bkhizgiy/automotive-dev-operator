apiVersion: automotive.sdv.cloud.redhat.com/v1alpha1
kind: OperatorConfig
metadata:
  labels:
    app.kubernetes.io/name: automotive-dev-operator
    app.kubernetes.io/managed-by: kustomize
  name: config
  namespace: automotive-dev-operator-system
spec:
  # OSBuilds configuration for OS build operations
  osBuilds:
    # Enable Tekton tasks for OS builds
    enabled: true

    # Size for persistent volume claims created for build workspaces
    # Default: "8Gi"
    pvcSize: "8Gi"

    # Optional: Use memory-backed volumes for faster builds
    # Requires memoryVolumeSize to be set if enabled
    # useMemoryVolumes: false

    # Optional: Size limit for memory-backed volumes (only if useMemoryVolumes is true)
    # Example: "2Gi"
    # memoryVolumeSize: "2Gi"

    # Optional: Node selector for scheduling build pods to specific nodes
    # Build pods will only run on nodes with matching labels
    nodeSelector:
      aib: "true"

    # Optional: Tolerations for exclusive access to tainted nodes
    # Enables scheduling on nodes tainted for dedicated automotive builds
    # First taint nodes: kubectl taint nodes <node> automotive.sdv.cloud.redhat.com/dedicated=builds:NoSchedule
    # Then configure tolerations to access those nodes:
    # tolerations:
    # - key: "automotive.sdv.cloud.redhat.com/dedicated"
    #   operator: "Equal"
    #   value: "builds"
    #   effect: "NoSchedule"
    # - key: "node.kubernetes.io/dedicated"
    #   operator: "Equal"
    #   value: "automotive"
    #   effect: "NoExecute"

  # BuildAPI configuration for the Build API server
  buildAPI:
    # Optional: Authentication configuration for OIDC/JWT providers
    # authentication:
    #   # OIDC client ID for caib CLI
    #   clientId: "caib-cli"
    #   # Internal authentication configuration
    #   internal:
    #     prefix: "internal:"
    #   # JWT/OIDC authentication providers
    #   jwt:
    #     - issuer:
    #         url: "https://sso.redhat.com/auth/realms/EmployeeIDP"
    #         audiences:
    #           - "caib-cli"
    #       claimMappings:
    #         username:
    #           claim: "preferred_username"
    #           prefix: ""