apiVersion: automotive.sdv.cloud.redhat.com/v1alpha1
kind: ImageBuild
metadata:
  labels:
    app.kubernetes.io/name: automotive-dev-operator
    app.kubernetes.io/managed-by: kustomize
  name: imagebuild-sample
  annotations:
    description: >
      Example ImageBuild CR showing the new nested structure.
      This example demonstrates a traditional AIB build with optional disk export.
spec:
  # ─── Common Configuration ───
  architecture: "amd64"  # or "arm64"
  #storageClass: "lvms-vg1"  # use cluster default if not specified
  #runtimeClassName: "kata"   # optional container runtime
  #secretRef: "registry-credentials"  # optional registry authentication

  # ─── AIB Configuration ───
  aib:
    distro: "autosd"           # required: distribution to build
    target: "qemu"          # required: target platform
    mode: "image"           # package, image, bootc, disk
    manifest: |
      # Sample AIB manifest
      # Replace with actual manifest content
      name: sample-build
    manifestFileName: "sample.aib.yml"
    image: "quay.io/centos-sig-automotive/automotive-image-builder:1.0.0"
    #builderImage: ""       # optional: custom osbuild builder
    #inputFilesServer: false # optional: enable file upload server
    #containerRef: ""       # required for mode=disk

  # ─── Export Configuration ───
  export:
    format: "qcow2"         # raw, qcow2, simg
    compression: "gzip"     # gzip, lz4, xz
    buildDiskImage: false   # whether to create disk image
    #container: "quay.io/myorg/my-container:latest"  # bootc container destination
    #disk:                  # disk image export options
    #  oci: "quay.io/myorg/my-disk:latest"  # export disk as OCI artifact
